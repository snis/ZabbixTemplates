# ZabbixTemplates

A set of Zabbix 7.x templates maintained by @snis.

## Templates

- **KumaUptimeByHttp/**
  - `UptimeKumaByHttp.yaml` – Zabbix template for ingesting **Uptime Kuma** metrics via **HTTP** (`/metrics`) without a Prometheus server.
  - `README.md` – Usage, requirements, and troubleshooting.

---

## Uptime Kuma by HTTP (overview)

Receives Uptime Kuma monitor metrics (status, latency, and—when present—TLS certificate info) by polling the Kuma `/metrics` endpoint with Zabbix **HTTP agent** and parsing with **Prometheus preprocessors**.

**Highlights**
- One HTTP master item, two LLD rules (Core + TLS), dependent item prototypes.
- Per-type latency thresholds via **context macros** (e.g. DNS vs HTTP vs TCP vs PING).
- Clean tagging across items/triggers: `origin=kuma`, `component=health|latency|tls|cert`, and trigger `scope=availability|performance|notice`.
- Only one graph prototype (response time); certificate “days remaining” is stored as **no-history** (linear/low-value series), plus a derived **expiry date** item.

**Compatibility**
- Tested on **Zabbix 7.2**
- Uptime Kuma **/metrics** enabled

---

## Quick start

1. In **Kuma GUI**: *Settings → API Keys → + Add API Key*  
   Name it (e.g., `zabbix`), set Expiry (or *Don’t expire*), click **Generate** and **copy the key**.
2. In **Zabbix**: import `UptimeKumaByHttp.yaml` (Data collection → Templates → Import).
3. Create/link a **host** for your Kuma (no interface required).
4. Set macros on the template/host:
   - `{$KUMA.URL}` = `https://<your-kuma>:3001`
   - `{$KUMA.BASIC_PASS}` = **API key** (leave `{$KUMA.BASIC_USER}` empty), or use basic user/pass.
5. Open the template → **Discovery rules** → **Execute now** (both Core & TLS).

---

## Macros (key ones)

- **Connection & auth**
  - `{$KUMA.URL}` – Base URL to Kuma `/metrics`.
  - `{$KUMA.BASIC_USER}` – Leave empty if using API key.
  - `{$KUMA.BASIC_PASS}` – API key (or basic password).

- **Polling**
  - `{$KUMA.MASTER.DELAY}` – poll interval for the master item (default `1m`).

- **Latency thresholds** (per monitor **type** via context):
  - `{$KUMA.RT.WARN:"http"}` / `{$KUMA.RT.CRIT:"http"}`
  - `{$KUMA.RT.WARN:"dns"}` / `{$KUMA.RT.CRIT:"dns"}`
  - `{$KUMA.RT.WARN:"tcp"}` / `{$KUMA.RT.CRIT:"tcp"}`
  - `{$KUMA.RT.WARN:"ping"}` / `{$KUMA.RT.CRIT:"ping"}`
  - Fallbacks: `{$KUMA.RT.WARN}` / `{$KUMA.RT.CRIT}`

- **TLS**
  - `{$KUMA.CERT.DAYS.WARN}` / `{$KUMA.CERT.DAYS.CRIT}` – thresholds for expiring certificates.

---

## Tagging

- Template-level: `origin=kuma`
- Items: `component=health|latency|tls|cert`, `origin=kuma`
- Triggers: `scope=availability|performance|notice`, plus `origin=kuma`

---

## Troubleshooting

- **No data**: confirm `{$KUMA.URL}/metrics` is reachable from Zabbix server/proxy.
- **Auth**: with API key, set it in `{$KUMA.BASIC_PASS}` and keep `{$KUMA.BASIC_USER}` empty.
- **No cert items**: only created for monitors that expose `monitor_cert_*`.

---

## Feedback

You can discuss this template or leave feedback at  
**https://github.com/snis/ZabbixTemplates**

**Generated by @snis**

